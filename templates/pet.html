<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayudar a {{ pet.name }} - Pet Rescue QR</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 0 15px; text-align: center; }
        .pet-photo { max-width: 200px; border-radius: 8px; margin: 10px 0; }
        button { background: #2196F3; color: white; padding: 12px 24px; border: none; cursor: pointer; font-size: 16px; }
        button:hover { background: #1976D2; }
        .loading { display: none; margin-top: 10px; }
    </style>
</head>
<body>
    <h1> 驴Viste a {{ pet.name }}?</h1>

    {% if pet.photo_path %}
        <img src="{{ pet.photo_path }}" alt="Foto de {{ pet.name }}" class="pet-photo">
    {% endif %}

    <p><strong>Raza:</strong> {{ pet.breed or "No especificada" }}</p>
    <p><strong>Se帽as:</strong> {{ pet.description or "No especificadas" }}</p>

    <button id="helpBtn">S铆, quiero ayudar</button>
    <div class="loading" id="loading">Obteniendo ubicaci贸n...</div>

    <script>
document.getElementById("helpBtn").onclick = async () => {
    const button = document.getElementById("helpBtn");
    const loading = document.getElementById("loading");
    button.disabled = true;
    loading.style.display = "block";
    loading.textContent = "Obteniendo ubicaci贸n...";

    try {
        const position = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject, {
                enableHighAccuracy: true,
                timeout: 10000
            });
        });

        const response = await fetch("/report", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                pet_id: "{{ pet.id }}",
                lat: position.coords.latitude,
                lng: position.coords.longitude
            })
        });

        if (response.ok) {
            // Redirigir a la p谩gina de agradecimiento
            window.location.href = "/thanks";
        } else {
            loading.textContent = "No se pudo enviar la ubicaci贸n.";
        }
    } catch (error) {
        loading.textContent = "No se pudo obtener la ubicaci贸n.";
        console.error("Error:", error);
    }
};
</script>
</body>
</html>