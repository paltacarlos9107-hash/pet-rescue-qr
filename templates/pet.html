<script>
document.getElementById("helpBtn").onclick = async () => {
    const button = document.getElementById("helpBtn");
    const loading = document.getElementById("loading");
    button.disabled = true;
    loading.style.display = "block";
    loading.textContent = "Obteniendo ubicaci칩n...";

    try {
        const position = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject, {
                enableHighAccuracy: true,
                timeout: 10000
            });
        });

        const response = await fetch("/report", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                pet_id: "{{ pet.id }}",
                lat: position.coords.latitude,
                lng: position.coords.longitude
            })
        });

        if (response.ok) {
            // Redirigir a la p치gina de agradecimiento
            window.location.href = "/thanks";
        } else {
            loading.textContent = "No se pudo enviar la ubicaci칩n.";
        }
    } catch (error) {
        loading.textContent = "No se pudo obtener la ubicaci칩n.";
        console.error("Error:", error);
    }
};
</script>