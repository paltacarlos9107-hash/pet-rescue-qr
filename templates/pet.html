<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayudar a {{ pet.name }} - Pet Rescue QR</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 0 15px; text-align: center; }
        .pet-photo { max-width: 200px; border-radius: 8px; margin: 10px 0; }
        .contact-info { background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 15px 0; }
        .contact-info a { color: #1976d2; text-decoration: none; font-weight: bold; }
        button { background: #2196F3; color: white; padding: 12px 24px; border: none; cursor: pointer; font-size: 16px; margin-top: 10px; }
        button:hover { background: #1976D2; }
        .loading { display: none; margin-top: 10px; }
    </style>
</head>
<body>
    <h1> 驴Viste a {{ pet.name }}?</h1>

    {% if pet.photo_url %}
        <img src="{{ pet.photo_url }}" alt="Foto de {{ pet.name }}" class="pet-photo">
    {% endif %}

    <p><strong>Raza:</strong> {{ pet.breed or "No especificada" }}</p>
    <p><strong>Se帽as particulares:</strong> {{ pet.description or "No especificadas" }}</p>

    <div class="contact-info">
        <p><strong> Contacto del due帽o:</strong></p>
        {% if pet.owner_phone %}
            <a href="tel:{{ pet.owner_phone }}">{{ pet.owner_phone }}</a>
        {% else %}
            <span>No disponible</span>
        {% endif %}
        <br>
        <small>(Al hacer clic, se inicia una llamada desde tu celular)</small>
    </div>

    <button id="helpBtn">S铆, quiero ayudar (enviar ubicaci贸n)</button>
    <div class="loading" id="loading">Obteniendo ubicaci贸n...</div>

    <!-- Script de geolocalizaci贸n -->
    <script>
        document.getElementById("helpBtn").onclick = async () => {
            const button = document.getElementById("helpBtn");
            const loading = document.getElementById("loading");
            button.disabled = true;
            loading.style.display = "block";

            try {
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject, {
                        enableHighAccuracy: true,
                        timeout: 10000
                    });
                });

                const response = await fetch("/report", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        pet_id: "{{ pet.id }}",
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    })
                });

                if (response.ok) {
                    window.location.href = "/thanks";
                } else {
                    loading.textContent = "No se pudo enviar la ubicaci贸n.";
                }
            } catch (error) {
                loading.textContent = "No se pudo obtener la ubicaci贸n.";
                console.error(error);
            }
        };
    </script>
</body>
</html>